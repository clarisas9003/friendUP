<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        img{max-width: 200px;}
    </style>
</head>
<body>
    <input type = "text" id = "username" placehold = "username">
    <input type = "text" id = "password" placholder = "password">
    <br></br>
    <input type = "file" id = "image">
    <br><br><br><br>
    <button id = "login">login</button>
    <button id = "create">create</button>

    <img src = "" alt = "upload image" id = "myimg">

    <script type = "module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword  } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL  } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-storage.js";

        
        const firebaseConfig = {
        apiKey: "AIzaSyD81cBEPMt9kcBIFANHK8Z7E9zAMv0uYCg",
        authDomain: "friendup-74935.firebaseapp.com",
        databaseURL: "https://friendup-74935-default-rtdb.firebaseio.com",
        projectId: "friendup-74935",
        storageBucket: "friendup-74935.appspot.com",
        messagingSenderId: "97865803459",
        appId: "1:97865803459:web:b5456ce09d5fb2106d2476",
        measurementId: "G-JHX6HNC0ST"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const storage = getStorage(app);

        document.getElementById("create").addEventListener("click", function(){
        var email = document.getElementById("username").value
        var password = document.getElementById("password").value
            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Signed in 
                    const user = userCredential.user;
                    console.log("created");
                    console.log(user)
                    // ...
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    // ..
                });

                var file = document.getElementById("image").file[0]

                //uploads to storage in firebase, key is through email
                uploadBytes(ref(storage,email), file).then((snapshot) => {
                    console.log('Uploaded a blob or file!');
                });
            })
            
                document.getElementById("login").addEventListener("click", function(){
                var email = document.getElementById("username").value;
                var password = document.getElementById("password").value;

                signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        // Signed in 
                        const user = userCredential.user;
                        console.log(user);
                        console.log("login");
                        // ...
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                    });

                    //retrieving image attached to email
                    getDownloadURL(ref(storage, email))
                        .then((url) => {
                            // Or inserted into an <img> element
                            const img = document.getElementById('myimg');
                            img.setAttribute('src', url);
                        })
                        .catch((error) => {
                            console.log(error)
                        });

            
            })



    </script>

</body>
</html>